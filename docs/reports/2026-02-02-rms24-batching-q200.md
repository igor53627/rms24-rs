# RMS24 Batching Benchmark (Full DB, 200 Queries)

**Date:** 2026-02-02

## Goal

Measure the impact of batching network queries in the benchmark client/server on full DB runs.

## Environment

- Host: hsiao
- Repo: /root/worktrees/rms24/plan-batching-impl
- Branch/commit: plan-batching-impl @ 4ed41350a96fafa9a6fa90d8b25d98297b501c8f
- Build: `cargo build --release`

## Dataset

- DB: `/data/rms24/full/database.bin`
- Entry size: 40 bytes
- Lambda: 80
- State cache: `/data/rms24/cache/full_state_seed1.bin`

## Commands

Server:
```
./target/release/rms24_server \
  --db /data/rms24/full/database.bin \
  --entry-size 40 \
  --lambda 80 \
  --listen 127.0.0.1:4000 \
  --max-batch-queries 16 \
  --timing --timing-every 1000
```

Client (per batch size N):
```
./target/release/rms24_client \
  --db /data/rms24/full/database.bin \
  --entry-size 40 \
  --lambda 80 \
  --server 127.0.0.1:4000 \
  --query-count 200 \
  --seed 1 \
  --batch-size N \
  --timing --timing-every 200 \
  --state /data/rms24/cache/full_state_seed1.bin
```

Logs: `/data/rms24/runs/batch_20260202_070833_q200`

## Results (RMS24 mode, 200 logical queries)

Note: each logical query generates 2 network queries (real + dummy). Batch size is in network queries per frame.

| Batch size | Frames (read_frame count) | Elapsed ms | Build query avg (us) | Read frame avg (us) |
| --- | --- | --- | --- | --- |
| 1 | 400 | 139,686 | 650,469 | 23,683 |
| 4 | 100 | 131,868 | 652,098 | 13,392 |
| 8 | 50 | 131,538 | 650,544 | 26,505 |
| 16 | 25 | 131,418 | 650,049 | 52,353 |

## Observations

- Batching reduced total time by ~5.6% to ~5.9% versus batch size 1.
- Query build time dominates total runtime and is effectively unchanged by batching.
- Read-frame time per frame rises as batch size increases (expected), while number of frames drops.

## Follow-ups

- Profiling and optimizing `build_query` should yield larger gains than further batching changes.
- Consider a larger query count sweep once build_query is improved.
